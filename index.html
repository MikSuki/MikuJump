<!doctype html>
<html>

<head>
	<title>MikuJump</title>
	<style>
		body {
			margin: 0;
			height: 100%;
		}

		#startButton {
			position: relative;
			left: 20%;
			width: 300px;
			height: 100px;
			font-size: 30px;
		}

		#mainCanvas {
			display: block;
			margin: 0 auto;
		}

		#reloadButton {
			display: none;
			position: absolute;
			top: 40%;
			left: 40%;
			background: linear-gradient(#FF8888, red);
			padding: 10px 20px;
			text-align: center;
			font-size: 40px;
			border-radius: 20px;
			border: 1.5px solid black;
			width: 15%;
			height: 11%;
			opacity: 0;
		}

		#reloadButton:hover {
			background: linear-gradient(to left, #66FFFF, #00DDDD, #0066FF);
			cursor: pointer;
			color: white;
			opacity: 1;
		}

		#reloadButtonText {
			display: none;
		}

		#reloadButton:hover #reloadButtonText {
			display: block;
		}

		#gameoverText {
			display: none;
			z-indexx: 99;
			font-size: 100px;
			position: absolute;
			top: 10%;
			left: 20%;
		}
	</style>

</head>

<body>
	<canvas id="mainCanvas"></canvas>
	<span id="gameoverText">G a m e o v e r</span>
	<button id="reloadButton" onclick="reload()">
		<span id="reloadButtonText">Reload</span>
	</button>

	<script>
		function touhaaa() {
			console.log('touch')
		}
		var canvas = document.getElementById("mainCanvas");
		var ctx = canvas.getContext("2d");
		var imgTree = new Image();
		var imgTrashCan = new Image();
		var rock = new Image();
		var cloud = [];
		var cloudPos;
		var imgPlayerList = [];
		var interval;
		//character
		var player, tree, TrashCan;
		//choose which enemy   0 : tree  1 : trashCan
		var s;
		var speed = 10;
		//change player expression
		var blinkTime;
		var walkTime;
		//boolean gameover
		var over = false;
		var canvasHeight, canvasWidth;
		var gameoverText, reloadBtn;
		imgTree.src = "picture/tree.png";
		imgTrashCan.src = "picture/trashCan.png";
		rock.src = "picture/rock.png";
		for (var i = 0; i < 9; i++)
			imgPlayerList[i] = new Image();
		imgPlayerList[0].src = "picture/MikuStand1.png";
		imgPlayerList[1].src = "picture/MikuStand2.png";
		imgPlayerList[2].src = "picture/MikuWalk1.png";
		imgPlayerList[3].src = "picture/MikuWalk2.png";
		imgPlayerList[4].src = "picture/MikuJump1.png";
		imgPlayerList[5].src = "picture/MikuJump2.png";
		imgPlayerList[6].src = "picture/MikuStandCry.png";
		imgPlayerList[7].src = "picture/MikuWalkCry.png";
		imgPlayerList[8].src = "picture/MikuJumpCry.png";

		for (var i = 0; i < 5; i++)
			cloud[i] = new Image();
		cloud[0].src = "picture/cloud1.png";
		cloud[1].src = "picture/cloud2.png";
		cloud[2].src = "picture/cloud3.png";
		cloud[3].src = "picture/cloud4.png";
		cloud[4].src = "picture/cloud5.png";

		window.onload = function createACanvas() {
			document.body.appendChild(canvas);
			canvasWidth = window.innerWidth;
			canvasHeight = window.innerHeight;
			canvasHeight = (canvasHeight > canvasWidth) ? Math.floor(canvasWidth / 2) : canvasHeight;
			canvas.width = canvasWidth;
			canvas.height = canvasHeight;

			gameoverText = document.getElementById("gameoverText");
			reloadBtn = document.getElementById("reloadButton");
			screen.start();
		}

		var screen = {
			start: function () {
				blinkTime = 0;
				walkTime = 0;
				cloudPos = 0;
				random();
				var width = canvasWidth * 0.3 * 0.49;
				var height = width / 0.49 * 0.4;
				var x = canvasWidth * 0.05;
				var y = canvasHeight * 0.93 - height;
				player = new playerFunction(imgPlayerList[0], x, y, width, height, x, y, width, height);
				//player = new playerFunction(imgPlayerList[0],5,canvasHeight * 0.65,49,40,10,canvasHeight * 0.65+1,40,35);
				//tree = new enemy(imgTree,canvasWidth-50,canvasHeight * 0.70,26,36,canvasWidth-45,canvasHeight * 0.70+4,15,27);
				width = canvasWidth * 0.3 * 0.26;
				height = width / 0.26 * 0.36;
				x = canvasWidth * 0.95;
				y = canvasHeight * 0.93 - height;
				tree = new enemy(imgTree, x, y, width, height, x, y, width, height);

				width = canvasWidth * 0.3 * 0.27;
				height = width / 0.27 * 0.31;
				x = canvasWidth * 0.95;
				y = canvasHeight * 0.93 - height;

				//trashCan = new enemy(imgTrashCan,canvasWidth-50,canvasHeight * 0.72,27,31,canvasWidth-48,canvasHeight * 0.72+1,23,29);
				trashCan = new enemy(imgTrashCan, x, y, width, height, x, y, width, height);
				interval = setInterval(updateScreen, 20);
				// event
				document.addEventListener("keyup", function(event){
					if (event.keyCode == 32 && player.jumpTime == 1) jump();
				});
				canvas.addEventListener('touchstart', function(e){
					event.preventDefault();
					if (player.jumpTime == 1) jump();
				}, true);
				canvasWidth = canvas.width;
				canvasHeight = canvas.height;
			}
		}
		function updateScreen() {
			ctx.clearRect(0, 0, canvasWidth, canvasHeight);
			drawBackground();
			player.jump();
			player.update();
			if (s == 0) {
				tree.refresh();
				player.crash(tree);
				tree.update();
			}
			else {
				trashCan.refresh();
				player.crash(trashCan);
				trashCan.update();
			}
			blinkTime++;
			walkTime++;
			//change player picture
			if (player.jumpTime == 1) {
				if (walkTime <= 15)
					if (blinkTime <= 150)
						player.img = imgPlayerList[0];
					else
						player.img = imgPlayerList[1];
				else
					if (blinkTime <= 200)
						player.img = imgPlayerList[2];
					else
						player.img = imgPlayerList[3];
			}
			else
				if (blinkTime <= 150)
					player.img = imgPlayerList[4];
				else
					player.img = imgPlayerList[5];
			if (blinkTime == 200)
				blinkTime = 0;
			if (walkTime == 30)
				walkTime = 0;
		}


		function playerFunction(img, x, y, width, height, crashX, crashY, crashWidth, crashHeight) {
			this.jumpTime = 1;
			this.jumpForce = 0;
			this.img = img;
			this.x = x;
			this.y = y;
			this.width = width;
			this.height = height;
			this.crashX = crashX;
			this.crashY = crashY;
			this.crashWidth = crashWidth;
			this.crashHeight = crashHeight;
			this.update = function () {
				draw(this.img, this.x, this.y, this.width, this.height);
				//ctx.fillRect(this.crashX,this.crashY,this.crashWidth,this.crashHeight);
			}
			this.jump = function () {
				if (this.jumpForce > 0) {
					this.y -= this.jumpForce;
					this.crashY -= this.jumpForce;
					this.jumpForce -= 0.8;
				}
				if (this.jumpForce <= 0 && this.y < (canvasHeight * 0.93 - this.height)) {
					this.y += 7;
					this.crashY += 7;
				}
				else if (this.y >= (canvasHeight * 0.93 - this.height)) {
					this.jumpTime = 1;
				}
			}
			this.crash = function (o) {
				//player position
				var left = this.crashX;
				var right = this.crashX + this.crashWidth;
				var up = this.crashY;
				var down = this.crashY + this.crashHeight;
				//player center point position
				var centerX = this.crashX + this.crashWidth / 2;
				var centerY = this.crashY + this.crashHeight / 2;
				//enemy position
				var eLeft = o.crashX;
				var eRight = o.crashX + o.crashWidth;
				var eUp = o.crashY;
				var eDown = o.crashY + o.crashHeight;
				if ((left >= eLeft && left <= eRight) || (right >= eLeft && right <= eRight))
					if ((up >= eUp && up <= eDown) || (down >= eUp && down <= eDown))
						gameover();
				if (centerX >= eLeft && centerX <= eRight)
					if (centerY >= eUp && centerY <= eDown)
						gameover();
			}
		}

		function draw(img, x, y, width, height) {
			ctx.mozImageSmoothingEnabled = false;
			ctx.webkitImageSmoothingEnabled = false;
			ctx.msImageSmoothingEnabled = false;
			ctx.imageSmoothingEnabled = false;
			ctx.drawImage(img, x, y, width, height);
		}

		function drawBackground() {
			ctx.fillStyle = "#CCEEFF";
			ctx.fillRect(0, 0, canvasWidth, canvasHeight);
			ctx.fillStyle = "	#AA7700";
			ctx.fillRect(0, canvasHeight * 0.9, canvasWidth, canvasHeight);
			draw(rock, canvasWidth * 0.95, canvasHeight * 0.92, 10, 9);
			draw(cloud[0], canvasWidth * 0.9 + cloudPos, canvasHeight * 0.10, 43, 28);
			draw(cloud[1], canvasWidth * 1.5 + cloudPos, canvasHeight * 0.30, 29, 21);
			draw(cloud[2], canvasWidth * 2.3 + cloudPos, canvasHeight * 0.15, 42, 29);
			draw(cloud[3], canvasWidth * 2.9 + cloudPos, canvasHeight * 0.2, 72, 37);
			draw(cloud[4], canvasWidth * 3.6 + cloudPos, canvasHeight * 0.4, 56, 36);
			//random cloud type
			/*var one,two;
			one = Math.floor(Math.random()*5);
			two = one;
			while(two == one){
				two = Math.floor(Math.random()*5);
			}
			draw(cloud[one],canvasWidth * 0.6+cloudPos,canvasHeight * 0.30,29,21);
			two = Math.floor(Math.random()*5);*/
			cloudPos -= 0.5;
			if (cloudPos <= -4 * canvasWidth)
				cloudPos = 0;
		}

		function jump() {
			player.jumpForce = 25;
			player.jumpTime--;
		}
		function random() {
			s = Math.floor(Math.random() * 2);
		}

		function enemy(img, x, y, width, height, crashX, crashY, crashWidth, crashHeight) {
			this.img = img;
			this.x = x;
			this.y = y;
			this.width = width;
			this.height = height;
			this.crashX = crashX;
			this.crashY = crashY;
			this.crashWidth = crashWidth;
			this.crashHeight = crashHeight;
			this.update = function () {
				draw(this.img, this.x, this.y, this.width, this.height);
				//ctx.fillRect(this.crashX,this.crashY,this.crashWidth,this.crashHeight);
				this.x -= speed;
				this.crashX -= speed;
			}
			this.refresh = function () {
				if (this.x < -30) {
					this.x = canvasWidth - 50;
					if (s == 0)
						this.crashX = canvasWidth - 45;
					else
						this.crashX = canvasWidth - 48;
					random();
				}
			}
		}
		function gameover() {
			clearInterval(interval);
			over = true;
			gameoverText.style.display = "block";
			reloadBtn.style.display = "block";
			if (player.jumpTime == 0)
				draw(imgPlayerList[8], player.x, player.y, player.width, player.height);
			else if (walkTime <= 35)
				draw(imgPlayerList[6], player.x, player.y, player.width, player.height);
			else
				draw(imgPlayerList[7], player.x, player.y, player.width, player.height);
		}
		function reload() {
			over = false;
			gameoverText.style.display = "none";
			reloadBtn.style.display = "none";
			screen.start();
		}

	</script>
</body>

</html>